{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container mt-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Welcome TRY DASH, {{ request.user.username }}</h2>
        <!--<a href="{% url 'logout' %}" class="btn btn-danger">Logout</a>-->
        <a href="https://accounts.google.com/Logout" class="btn btn-danger">Full Logout</a>
    </div>

    <nav class="mb-4">
        <a href="{% url 'task_selection_staff' %}" class="btn btn-primary me-2">Start New Task</a>
        <a href="{% url 'task_list' %}" class="btn btn-secondary">All My Task Logs</a>
    </nav>

    <h4>Recent Task Logs</h4>
    <table class="table table-bordered table-striped">
        <thead>
            <tr>
                <th>Task ID</th>
                <th>PID</th>
                <th>Employee</th>
                <th>Task</th>
                <th>Start Time</th>
            </tr>
        </thead>
        <tbody>
            {% for log in tasklogs %}
            <tr>
                <td>{{ log.fk_task_id }}</td>
                <td>{{ log.user_pid }}</td>
                <td>{{ log.user_key }}</td>
                <td>{{ log.task }}</td>
                <td>{{ log.start_time|date:"Y-m-d H:i" }}</td>
            </tr>
            {% empty %}
            <tr><td colspan="2">No tasks found.</td></tr>
            {% endfor %}
        </tbody>
    </table>
</body>
</html>
<script>
    window.addEventListener("beforeunload", function () {
        // Attempt to logout from the app silently when the tab/window closes
        navigator.sendBeacon("{% url 'logout' %}");
    });
</script>