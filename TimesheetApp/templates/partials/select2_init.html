<script>
    (function () {
        // Feature: Disable submit until all required fields are valid + disable on submit
        const form = document.querySelector('form');
        if (!form) return;
        const submitBtn = form.querySelector('button[type="submit"]');
        if (!submitBtn) return;

        function validateFormEnable() {
            // Basic validity across required inputs
            const allValid = Array.from(form.elements).every(el => {
                if (el.type === 'hidden' || el.type === 'submit' || el.disabled) return true;
                if (el.hasAttribute('required')) return el.value && el.checkValidity();
                return true;
            });
            submitBtn.disabled = !allValid;
        }

        form.addEventListener('input', validateFormEnable);
        form.addEventListener('change', validateFormEnable);
        validateFormEnable();

        form.addEventListener('submit', function (e) {
            // Immediately disable to avoid double-submits; server will redirect or re-render
            submitBtn.disabled = true;
        });
    })();
</script>
